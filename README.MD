------

# ğŸ§© SpritePacker 

**SpritePacker** is a 2D sprite sheet packing tool, designed for game developers 

------

## ğŸ“¦ å®‰è£…

```bash
go install github.com/91xusir/spritepacker@latest
```

------

## ğŸ›  ä½¿ç”¨æ–¹å¼

### CLI å‘½ä»¤è¡Œ

```bash
go install github.com/91xusir/spritepacker@latest
spritepacker help
```

- ## ğŸ› ï¸ æ‰“åŒ…é€‰é¡¹

  | å‚æ•°         | è¯´æ˜                                                         |
  | ------------ | ------------------------------------------------------------ |
  | `-input`     | è¾“å…¥ç›®å½•ï¼ŒåŒ…å«å¾…æ‰“åŒ…çš„ç²¾çµå›¾åƒï¼ˆå¿…éœ€ï¼‰                       |
  | `-output`    | è¾“å‡ºç›®å½•ï¼Œé»˜è®¤ä¸º `output`                                    |
  | `-maxw`      | å›¾é›†æœ€å¤§å®½åº¦ï¼Œé»˜è®¤ `2048`                                    |
  | `-maxh`      | å›¾é›†æœ€å¤§é«˜åº¦ï¼Œé»˜è®¤ `2048`                                    |
  | `-padding`   | ç²¾çµä¹‹é—´çš„é—´è·ï¼Œé»˜è®¤ `2`                                     |
  | `-rotate`    | æ˜¯å¦å…è®¸æ—‹è½¬ç²¾çµä»¥èŠ‚çœç©ºé—´                                   |
  | `-pot`       | å¼ºåˆ¶å›¾é›†å°ºå¯¸ä¸º 2 çš„å¹‚ï¼ˆPower Of Twoï¼‰                        |
  | `-pma`       | ä½¿ç”¨é¢„ä¹˜é€æ˜åº¦ï¼ˆPremultiplied Alphaï¼‰                        |
  | `-name`      | è¾“å‡ºå›¾é›†çš„åŸºç¡€åç§°ï¼Œé»˜è®¤ `atlas`                             |
  | `-sort`      | æ‰“åŒ…å‰æ˜¯å¦æ’åºå›¾åƒï¼ˆé»˜è®¤å¯ç”¨ï¼‰                               |
  | `-trim`      | æ˜¯å¦è£å‰ªé€æ˜è¾¹ç¼˜ï¼ˆé»˜è®¤å¯ç”¨ï¼‰                                 |
  | `-tolerance` | è£å‰ªé€æ˜è¾¹ç¼˜çš„å®¹å·®ï¼ˆ0~255ï¼Œé»˜è®¤ `1`ï¼‰                        |
  | `-same`      | æ˜¯å¦å¯ç”¨é‡å¤å›¾åƒæ£€æµ‹ï¼ˆé»˜è®¤å¯ç”¨ï¼‰                             |
  | `-algo`      | æ‰“åŒ…ç®—æ³•é€‰æ‹©ï¼š 0 = Basicï¼Œ1 = Skylineï¼Œ2 = MaxRects          |
  | `-heuristic` | MaxRects å¯å‘ç­–ç•¥ï¼ˆä»…ç”¨äº `-algo 2`ï¼‰ï¼š 0 = BestShortSideFit 1 = BestLongSideFit 2 = BestAreaFit 3 = BottomLeft 4 = ContactPoint |

  ------

  ## ğŸ› ï¸ è§£åŒ…é€‰é¡¹

  | å‚æ•°        | è¯´æ˜                      |
  |-----------|-------------------------|
  | `-unpack` | å›¾é›†å¯¹åº”çš„ JSON è·¯å¾„ï¼ˆå¿…éœ€ï¼‰       |
  | `-img`    | å›¾é›†å›¾åƒè·¯å¾„ï¼ˆå¯é€‰ï¼Œé»˜è®¤æŒ‰ JSON åæ¨å¯¼ï¼‰ |
  | `-output` | è§£åŒ…è¾“å‡ºç›®å½•ï¼ˆå¯é€‰ï¼Œé»˜è®¤æŒ‰ JSON åæ¨å¯¼ï¼‰ |

  ------

  ## ğŸ“¦ ç¤ºä¾‹

  ```bash
  ä½¿ç”¨é»˜è®¤é…ç½®æ‰“åŒ… ./sprites ä¸‹çš„æ‰€æœ‰å›¾åƒ
  spritepacker -input ./sprites -output ./atlases
  
  # è‡ªå®šä¹‰å›¾é›†å°ºå¯¸ã€é—´è·ã€å¼€å¯æ—‹è½¬
  spritepacker -input ./sprites -maxw 1024 -maxh 1024 -padding 4 -rotate
  
  # è§£åŒ… atlas.json å¯¹åº”å›¾é›†
  spritepacker -unpack ./atlases/atlas.json -output ./unpacked
  ```

------

## ğŸ§ª API

```bash
go get -u github.com/91xusir/spritepacker
```

ä½¿ç”¨ç¤ºä¾‹

```go
package main
import (
	"github.com/91xusir/spritepacker/pack"
	"encoding/json"
	"os"
	"path/filepath"
)
func Pack() {
	// Step 1: Create packing options and set the maximum atlas size to 4096x4096
	options := pack.NewOptions().MaxSize(4096, 4096)

	// Optional: Validate the options. If invalid, an error will be returned.
	// Here we ignore the error for demonstration purposes.
	options, _ = options.Validate()

	// Step 2: Create the sprite packer using the configured options
	spritePacker := pack.NewPacker(options)

	// Step 3: Collect all sprite image paths from the "input" directory
	spriteImgPaths, _ := pack.GetFilesInDirectory("input")

	// Step 4: Pack all sprite images and generate atlas metadata and images
	spriteAtlasInfo, atlasImages, _ := spritePacker.PackSprites(spriteImgPaths)
	
	// Step 5: Save each atlas image to the "output" directory
	for i := range atlasImages {
		// If you plan to unpack the atlas using spriteAtlasInfo later,
		// you should use the atlas name from spriteAtlasInfo as the filename.
		// Only the name is required, and the file extension will be determined
		// based on the format passed (e.g., pack.PNG, pack.JPEG, etc.).
		// WithCLV is function to set the compression level of the image.
		outputPath := filepath.Join("output", spriteAtlasInfo.Atlases[i].Name)
		_ = pack.SaveImg(outputPath, atlasImages[i], pack.PNG, pack.WithCLV(pack.DefaultCompression))
	}

	// Step 6: Save the atlas metadata as a JSON file
	// By default, all atlas information is saved into a single file.
	// You can read spriteAtlasInfo to save each atlas information separately.
	// Correspondingly, you would need to customize the UnpackSprites method
	// to read each atlas information and save each atlas image.
	jsonBytes, _ := json.MarshalIndent(spriteAtlasInfo, "", "  ")
	_ = os.WriteFile("output/atlas.json", jsonBytes, os.ModePerm)

}

func Unpack() {
	// default output and atlas images path is the same as the atlas.json path
	// if you want to change this, you can use the following code:
	// pack.UnpackSprites("output/atlas.json", pack.WithAtlasImgPath("output"), pack.WithOutputPath("output"))
	err := pack.UnpackSprites("output/atlas.json")
	if err != nil {
		return
	}
	// Then you can use TestImageDiff to compare the output images with the input images
	// to verify that the unpacking process is correct.
}
```

